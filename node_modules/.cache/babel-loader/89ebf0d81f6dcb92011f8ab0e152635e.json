{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nimport React from \"react\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  query getProducts($ids: [ID!]!) {\\n    nodes(ids: $ids) {\\n      ... on Product {\\n        title\\n        handle\\n        description\\n        id\\n        totalVariants\\n        images(first: 1) {\\n          edges {\\n            node {\\n              originalSrc\\n              altText\\n            }\\n          }\\n        }\\n        variants(first: 10) {\\n          edges {\\n            node {\\n              price\\n              id\\n              image {\\n                originalSrc\\n                altText\\n              }\\n              displayName\\n              compareAtPrice\\n            }\\n          }\\n        }\\n      }\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport gql from 'graphql-tag';\nimport { Button, Caption, Card, Checkbox, DropZone, EmptyState, Form, FormLayout, Heading, Layout, Page, ResourceList, Select, Stack, Subheading, TextField, Thumbnail } from '@shopify/polaris';\nimport { Context } from \"@shopify/app-bridge-react\";\nimport { Redirect } from \"@shopify/app-bridge/actions\";\nimport store from \"store-js\";\nimport { Query } from \"react-apollo\";\nimport Modal from \"@shopify/app-bridge-react/components/Modal\";\nimport ResourceListWithProducts from \"./ResourceList\"; //TODO: fetch all variants, not first 10\n\nvar GET_PRODUCT_BY_ID = gql(_templateObject());\n\nvar CreateTestVariant =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CreateTestVariant, _React$Component);\n\n  function CreateTestVariant() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CreateTestVariant);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CreateTestVariant)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      files: [],\n      productSelected: 'product',\n      variantSelected: 0,\n      productTitle: '',\n      productDescription: '',\n      variantTitle: '',\n      variantPrice: '',\n      variantDiscount: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"redirect\", function () {\n      _this.props.variantCreated(false);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"itemToBeConsumed\", function () {\n      var item = store.get('item');\n      var price = item.variants.edges[0].node.price;\n      var variantId = item.variants.edges[0].node.id;\n      var discounter = price * 0.1;\n\n      _this.setState({\n        price: price,\n        variantId: variantId\n      });\n\n      return (price - discounter).toFixed(2);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleTextChange\", function (value) {\n      _this.setState({\n        value: value\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleProductOrVariantSelectChange\", function (data, newValue) {\n      _this.setState({\n        productTitle: data.nodes[0].title,\n        productSelected: newValue,\n        variantTitle: data.nodes[0].variants.edges[0].node.displayName,\n        variantPrice: data.nodes[0].variants.edges[0].node.price,\n        variantDiscount: data.nodes[0].variants.edges[0].node.compareAtPrice\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleVariantSelectChange\", function (variantsArray, newValue) {\n      newValue = _parseInt(newValue, 10);\n\n      _this.setState({\n        variantSelected: newValue,\n        variantTitle: variantsArray[newValue].node.displayName,\n        variantPrice: variantsArray[newValue].node.price,\n        variantDiscount: variantsArray[newValue].node.compareAtPrice\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleProductSubmit\", function () {});\n\n    _defineProperty(_assertThisInitialized(_this), \"handleVariantSubmit\", function () {});\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSave\", function () {});\n\n    return _this;\n  }\n\n  _createClass(CreateTestVariant, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var productOrVariantSelectOptions = [{\n        label: 'Product',\n        value: 'product'\n      }, {\n        label: 'Variants',\n        value: 'variants'\n      }];\n      var app = this.context;\n      var files = this.state.files;\n      var validImageTypes = ['image/gif', 'image/jpeg', 'image/png'];\n      console.log(this.state.files);\n\n      if (this.state.files.length != 0) {\n        console.log(window.URL.createObjectURL(this.state.files[0]));\n      }\n\n      var fileUpload = !files.length && React.createElement(DropZone.FileUpload, null);\n      var uploadedFiles = files.length > 0 && React.createElement(Stack, {\n        vertical: true\n      }, files.map(function (file, index) {\n        return React.createElement(Stack, {\n          alignment: \"center\",\n          key: index\n        }, React.createElement(Thumbnail, {\n          size: \"large\",\n          alt: file.name,\n          source: validImageTypes.indexOf(file.type) > 0 ? window.URL.createObjectURL(file) : 'https://cdn.shopify.com/s/files/1/0757/9955/files/New_Post.png?12678548500147524304'\n        }), React.createElement(\"div\", null, file.name, \" \", React.createElement(Caption, null, file.size, \" bytes\")));\n      }));\n      return React.createElement(Query, {\n        query: GET_PRODUCT_BY_ID,\n        variables: {\n          ids: store.get('ids')\n        }\n      }, function (_ref) {\n        var data = _ref.data,\n            loading = _ref.loading,\n            error = _ref.error;\n\n        if (loading) {\n          return React.createElement(\"div\", null, \"Loading\\u2026\");\n        }\n\n        if (error) {\n          return React.createElement(\"div\", null, error.message);\n        }\n\n        var variantsArray = data.nodes[0].variants.edges;\n        var variantSelectOptions = [];\n        variantsArray.forEach(function (variant, index) {\n          variantSelectOptions.push({\n            label: variant.node.displayName,\n            value: index\n          });\n        });\n        console.log(data);\n        return React.createElement(Page, {\n          primaryAction: {\n            content: 'Create A/B Test',\n            onAction: function onAction() {\n              return _this2.handleSave;\n            }\n          }\n        }, React.createElement(Select, {\n          label: \"Create test for:\",\n          disabled: false,\n          options: productOrVariantSelectOptions,\n          onChange: _this2.handleProductOrVariantSelectChange.bind(_this2, data),\n          value: _this2.state.productSelected\n        }), _this2.state.productSelected === 'product' ? React.createElement(Form, {\n          onSubmit: _this2.handleProductSubmit\n        }, React.createElement(FormLayout, null, React.createElement(Stack, null, React.createElement(Thumbnail, {\n          size: \"large\",\n          source: data.nodes[0].images.edges[0] ? data.nodes[0].images.edges[0].node.originalSrc : '',\n          alt: data.nodes[0].images.edges[0] ? data.nodes[0].images.edges[0].node.altText : ''\n        }), React.createElement(DropZone, {\n          onDrop: function onDrop(files, acceptedFiles, rejectedFiles) {\n            _this2.setState({\n              files: [].concat(_toConsumableArray(_this2.state.files), _toConsumableArray(acceptedFiles))\n            });\n          }\n        }, uploadedFiles, fileUpload)), React.createElement(TextField, {\n          readOnly: false,\n          value: _this2.state.productTitle,\n          onChange: _this2.handleTextChange,\n          label: \"Product Name\",\n          type: \"text\"\n        }))) : React.createElement(Form, {\n          onSubmit: _this2.handleVariantSubmit\n        }, React.createElement(FormLayout, null, React.createElement(Select, {\n          label: \"Select product variant to create test for:\",\n          disabled: false,\n          options: variantSelectOptions,\n          value: _this2.state.variantSelected,\n          onChange: _this2.handleVariantSelectChange.bind(_this2, variantsArray)\n        }), React.createElement(Stack, null, React.createElement(Thumbnail, {\n          size: \"large\",\n          source: data.nodes[0].variants.edges[_this2.state.variantSelected].node.image ? data.nodes[0].variants.edges[_this2.state.variantSelected].node.image.originalSrc : data.nodes[0].images.edges[0].node.originalSrc,\n          alt: data.nodes[0].variants.edges[_this2.state.variantSelected].node.image ? data.nodes[0].variants.edges[_this2.state.variantSelected].node.image.altText : data.nodes[0].images.edges[0].node.altText\n        }), React.createElement(DropZone, {\n          onDrop: function onDrop(files, acceptedFiles, rejectedFiles) {\n            _this2.setState({\n              files: [].concat(_toConsumableArray(_this2.state.files), _toConsumableArray(acceptedFiles))\n            });\n          }\n        }, uploadedFiles, fileUpload)), React.createElement(TextField, {\n          readOnly: false,\n          value: _this2.state.variantTitle,\n          onChange: _this2.handleTextChange,\n          label: \"Product Name\",\n          type: \"text\"\n        }), React.createElement(TextField, {\n          readOnly: false,\n          value: _this2.state.variantPrice,\n          onChange: _this2.handleTextChange,\n          label: \"Original Price\",\n          type: \"text\"\n        }), React.createElement(TextField, {\n          readOnly: false,\n          value: _this2.state.variantDiscount,\n          onChange: _this2.handleTextChange,\n          label: \"Discounted Price\",\n          type: \"text\"\n        }))));\n      });\n    }\n  }]);\n\n  return CreateTestVariant;\n}(React.Component);\n\n_defineProperty(CreateTestVariant, \"contextType\", Context);\n\nexport default CreateTestVariant;","map":null,"metadata":{},"sourceType":"module"}